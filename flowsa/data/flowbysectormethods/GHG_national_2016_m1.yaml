%YAML 1.1

---
# m1 for the GHG national replicates the method used in the National GHG Industry Attribution Model, except that
# sector attribution is to 6-digit NAICS, rather than the BEA 2012 IO schema

target_sector_level: NAICS_6 #this should perhaps be 4 or 5 to be closer to BEA_2012
target_sector_source: NAICS_2012_Code
target_geoscale: national
source_names:
  "EPA_GHGI_T_2_1": #U.S. GHG emissions
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:
        names:
          - "Iron and Steel Production & Metallurgical Coke Production" #CO2, CH4
          - "Cement Production" #CO2
          - "Lime Production" #CO2
          - "Ammonia Production" #CO2
          - "Incineration of Waste" #CO2, #N2O
          - "Aluminum Production" #CO2
          - "Soda Ash Production" #CO2
          - "Ferroalloy Production" #CO2, CH4
          - "Titanium Dioxide Production" #CO2
          - "Zinc Production" #CO2
          - "Phosphoric Acid Production" #CO2
          - "Glass Production" #CO2
          - "Carbide Production and Consumption" #CO2, CH4
          - "Landfills" #CH4
          - "Coal Mining" #CH4
          - "Wastewater Treatment" #CH4, N2O
          - "Rice Cultivation" #CH4
          - "Abandoned Oil and Gas Wells" #CH4
          - "Abandoned Underground Coal Mines" #CH4
          - "Anaerobic Digestion at Biogas Facilities" #CH4 new activity
          - "Composting" #CH4, N2O
          - "Nitric Acid Production" #N2O
          - "Adipic Acid Production" #N2O
          - "Caprolactam, Glyoxal, and Glyoxylic Acid Production" #CH4
          - "Electronics Industry" #N2O
        source_flows: ["CO2", "CH4", "N2O"] # HFCs and other flows are pulled elsewhere
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_2:
        names:
          - "Electrical Transmission and Distribution" #SF6
        source_flows: ["SF6"]
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_3: &electricity_make
        names:
        - "Electric Power" #CO2
        allocation_method: proportional
        allocation_source: "BEA_Make_Detail_BeforeRedef"
        allocation_source_class: "Money"
        allocation_source_year: 2012
        allocation_flow:
          - "USD2012"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: subset_BEA_table
        clean_parameter: {"221100": 'ActivityConsumedBy'} # Electricity
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: 2012
        helper_flow:
          - "Number of employees"
        helper_from_scale: national
        clean_helper_fba: clean_bls_qcew_fba
        clean_helper_fba_wsec: bls_clean_allocation_fba_w_sec
      activity_set_4: &use_allocation
        names:
        - "Liming"  #CO2
        allocation_method: proportional
        allocation_source: "BEA_Use_Detail_PRO_BeforeRedef"
        allocation_source_class: "Money"
        allocation_source_year: 2012
        allocation_flow:
          - "USD2012"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: subset_BEA_table
        clean_parameter: {"327400": 'ActivityProducedBy'} # Lime
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: 2012
        helper_flow:
          - "Number of employees"
        helper_from_scale: national
        clean_helper_fba: clean_bls_qcew_fba
        clean_helper_fba_wsec: bls_clean_allocation_fba_w_sec
      activity_set_5:
        <<: *use_allocation
        names:
        - "Urea Fertilization" #CO2
        - "Urea Consumption for Non-Agricultural Purposes" #CO2
        clean_parameter: {"325310": 'ActivityProducedBy'} # Fertilizers
      activity_set_6:
        <<: *use_allocation
        names:
        - "Other Process Uses of Carbonates" #CO2
        clean_parameter: {"325180": 'ActivityProducedBy'} # Other Basic Inorganic Chemicals
      activity_set_7:
        names:
        - "Lead Production" #CO2
        allocation_method: proportional
        allocation_source: "USGS_MYB_Lead"
        allocation_source_class: "Geological"
        allocation_source_year: 2016
        allocation_flow:
        - "lead production Primary lead, refined content, domestic ores and base bullion "
        - "lead production Secondary lead, lead content"
        allocation_compartment: None
        allocation_from_scale: national
      activity_set_8:
        <<: *use_allocation
        names:
        - "N2O from Product Uses" #N2O
        clean_parameter: {"325120": 'ActivityProducedBy'} # Industrial gases

## Fossil Fuels
  "EPA_GHGI_T_3_63": &natgas #CH4 from Natural Gas Systems
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:
        names:
          - "Distribution"
          - "Exploration"
          - "Processing"
          - "Production"
          - "Transmission and Storage"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
  "EPA_GHGI_T_3_65": *natgas #CO2 from Natural Gas Systems mimics CH4
  "EPA_GHGI_T_3_67": *natgas #N2O from Natural Gas Systems, not used in original method, mimics CH4
  "EPA_GHGI_T_3_38": &petroleum #CH4 from Petroleum Systems
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:
        names:
          - "Crude Oil Transportation"
          - "Exploration"
          - "Production"
          - "Refining"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
  "EPA_GHGI_T_3_40": *petroleum #CO2 from Petroleum Systems mimics CH4
  "EPA_GHGI_T_3_42": *petroleum #N2O from Petroleum Systems, not in prior method, mimics CH4

## Agriculture
  "EPA_GHGI_T_5_29": #CH4, N2O, CO and NOx from field burning of residues
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:  #this set is direct
          names:
            - "Chickpeas"
            - "Cotton"
            - "Maize"
            - "Rice"
            - "Soybeans"
            - "Wheat"
          allocation_method: direct
          allocation_source: None
          allocation_from_scale: national
  "EPA_GHGI_T_5_3":  &animals #CH4 from Enteric Fermentation
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:
        names:
          - "American Bison"
          - "Beef Cattle"
          - "Dairy Cattle"
          - "Goats"
          - "Horses"
          - "Mules and Asses"
          - "Sheep"
          - "Swine"
          - "Poultry"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
  "EPA_GHGI_T_5_7": *animals #CH4 and N2O from manure, mimics enteric fermentation

  "EPA_GHGI_T_5_18": #Direct N2O emissions from agricultural soils
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:  # allocated based on fertilizer use
        <<: *use_allocation
        names:
            - "Organic Amendment Cropland"
            - "Residue N Cropland"
            - "Synthetic Fertilizer Cropland"
        clean_parameter: {"325310": 'ActivityProducedBy'} # Fertilizers
      activity_set_2:  # allocated based on USDA land area harvested
        names:
            - "Mineralization and Asymbiotic Fixation Cropland"
            - "Drained Organic Soils Cropland"
        allocation_source: "USDA_CoA_Cropland"
        allocation_method: proportional
        allocation_source_class: "Land"
        allocation_source_year: 2017
        allocation_flow:
          - "AREA HARVESTED"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: coa_irrigated_cropland_fba_cleanup
        clean_allocation_fba_w_sec: disaggregate_coa_cropland_to_6_digit_naics
      activity_set_3: &grassland # allocated based on USDA Animal operation land (acres)
        names:
            - "All activities Grassland"
        allocation_method: proportional
        allocation_source: "USDA_CoA_Cropland_NAICS"
        allocation_source_class: "Land"
        allocation_source_year: 2017
        allocation_flow:
          - "FARM OPERATIONS"
        allocation_compartment: None
        allocation_from_scale: national

  "EPA_GHGI_T_5_19": #Indirect N2O emissions from agricultural soils
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:  # allocated based on fertilizer use
        <<: *use_allocation
        names:
            - "Volatilization & Atm. Deposition Cropland"
            - "Surface Leaching & Run-Off Cropland"
        clean_parameter: {"325310": 'ActivityProducedBy'} # Fertilizers
      activity_set_2: *grassland # allocated based on USDA Animal operation land (acres)


## Mobile Sources
  "EPA_GHGI_T_3_14": &mobile #CH4 from mobile combustion
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1:  #this set is direct
        names:
            - "Passenger Cars Gasoline On-Road"
            - "Light-Duty Trucks Gasoline On-Road"
            - "Rail Non-Road"
            - "Ships and Boats Non-Road"
            - "Aircraft Non-Road"
            - "Medium- and Heavy-Duty Trucks and Buses Diesel On-Road"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_2: #this set is allocated by purchases of construction equipment
        <<: *use_allocation
        names:
          - "Construction/Mining Equipment Non-Road"
        clean_parameter: {"333120": 'ActivityProducedBy'} # purchases of construction equipment
      activity_set_3: #this set is allocated by purchases of farm machinery
        <<: *use_allocation
        names:
          - "Agricultural Equipment Non-Road"
        clean_parameter: {"333111": 'ActivityProducedBy'} # purchases of farm machinery
      activity_set_4: #this set is allocated by purchases of petroleum refining
        <<: *use_allocation
        names:
          - "Other Non-Road"
        clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery products
      activity_set_5: #this set is allocated by purchases of natural gas
        <<: *use_allocation
        names:
          - "Alternative Fuel On-Road"
        clean_parameter: {"221200": 'ActivityProducedBy'} # purchases of natural gas
  "EPA_GHGI_T_3_15": *mobile #N2O from mobile combustion duplicates method for CH4

## Major CO2 Sources
  "EPA_GHGI_T_A_14":  # CO2 emissions from stationary combustion and transportation
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: &year 2016
    clean_fba_df_fxn: allocate_industrial_combustion
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1: #direct allocation
        names:
            - "Total (All Fuels) Residential"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_2: # Coal
        <<: *use_allocation
        names:
            - "Commercial Coal Commercial"
            - "Industrial Other Coal Industrial"
        clean_parameter: {"212100": 'ActivityProducedBy'} # purchases of coal
      activity_set_3: # Natural Gas
        <<: *use_allocation
        names:
            - "Natural Gas  Commercial" # Note extra space
            - "Natural Gas  Industrial" # Note extra space
        clean_parameter: {"221200": 'ActivityProducedBy'} # purchases of natural gas
      activity_set_4: # Petroleum
        <<: *use_allocation
        names:
            - "Total Petroleum Commercial"
            - "Total Petroleum Industrial"
        clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery
      activity_set_5: &fuel_MECS # Industrial Coal for Manufacturing
        names:
            - "Industrial Other Coal Industrial - Manufacturing"
        allocation_method: proportional
        allocation_source: "EIA_MECS_Energy"
        allocation_source_class: "Energy" # fuel consumption
        allocation_source_year: 2014
        allocation_flow:
            - "Coal"
        allocation_compartment: None
        allocation_from_scale: national
        clean_allocation_fba: mecs_energy_fba_cleanup # use energy basis
        clean_allocation_fba_w_sec: eia_mecs_energy_clean_allocation_fba_w_sec
        helper_source: "BLS_QCEW"
        helper_method: proportional-flagged
        helper_source_class: "Employment"
        helper_source_year: 2014
        helper_flow: None
        helper_from_scale: national
        clean_helper_fba: clean_bls_qcew_fba
        clean_helper_fba_wsec: bls_clean_allocation_fba_w_sec
      activity_set_6: # Industrial Natural Gas for manufacturing
        <<: *fuel_MECS
        names:
            - "Natural Gas  Industrial - Manufacturing" # Note extra space
        allocation_flow:
            - "Natural Gas"
    ### Transportation
      activity_set_7: &transport_direct
        names:
            - "Natural Gas  Transportation" # Note extra space
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_79"
        allocation_source_class: "Energy"
        allocation_source_year: *year
        allocation_flow: ['Natural Gas']
        allocation_compartment: None
        allocation_from_scale: national
        helper_source: "BLS_QCEW"
        helper_method: proportional
        helper_source_class: "Employment"
        helper_source_year: 2017 # change to *year
        helper_flow:
          - "Number of employees"
        helper_from_scale: national
        clean_helper_fba: clean_bls_qcew_fba
        clean_helper_fba_wsec: bls_clean_allocation_fba_w_sec
      activity_set_8:
        <<: *transport_direct
        names:
            - "Aviation Gasoline Transportation"
        allocation_flow: ['Aviation Gasoline']
      activity_set_9:
        <<: *transport_direct
        names:
            - "Jet Fuel Transportation"
        allocation_flow: ['Jet Fuel']
      activity_set_10:
        <<: *transport_direct
        names:
            - "LPG (Propane) Transportation"
        allocation_flow: ['LPG']
      activity_set_11:
        <<: *transport_direct
        names:
            - "Residual Fuel Transportation"
        allocation_flow: ['Residual Fuel Oil']
      activity_set_12: &transport_use
        names:
            - "Distillate Fuel Oil Transportation"
        allocation_method: proportional
        allocation_source: "EPA_GHGI_T_A_79"
        allocation_source_class: "Energy"
        allocation_source_year: *year
        allocation_flow: ['Distillate Fuel Oil (Diesel Fuel)']
        allocation_compartment: None
        allocation_from_scale: national
        helper_source: "BEA_Use_Detail_PRO_BeforeRedef"
        helper_method: proportional
        helper_source_class: "Money"
        helper_source_year: 2012
        helper_flow: ["USD2012"]
        helper_from_scale: national
        clean_helper_fba: subset_BEA_table
        clean_parameter: {"324110": 'ActivityProducedBy'} # use of petroleum products
      activity_set_13:
        <<: *transport_use
        names:
            - "Motor Gasoline Transportation"
        allocation_flow: ['Motor Gasoline']


## Stationary Combustion
  "EPA_GHGI_T_3_8":  &stationary_combustion # CH4 emissions from stationary combustion
    data_format: 'FBA'
    class: Chemicals
    geoscale_to_use: national
    year: 2016
    clean_fba_df_fxn: allocate_industrial_combustion
    fedefl_mapping: 'GHGI'
    activity_sets:
      activity_set_1: #direct allocation
        names:
            - "Fuel Oil Residential"
            - "Coal Residential"
            - "Natural Gas Residential"
            - "Wood Residential"
        allocation_method: direct
        allocation_source: None
        allocation_from_scale: national
      activity_set_2:
        <<: *electricity_make # Electric power
        names:
            - "Coal Electric Power"
            - "Natural gas Electric Power"
            - "Fuel Oil Electric Power"
            - "Wood Electric Power"
      activity_set_3: # Commercial Fuel Oil
        <<: *use_allocation
        names:
            - "Fuel Oil Commercial"
            - "Fuel Oil Industrial"
        clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery
      activity_set_4: # Commercial Natural gas
        <<: *use_allocation
        names:
            - "Natural gas Commercial"
            - "Natural gas Industrial"
        clean_parameter: {"221200": 'ActivityProducedBy'} # purchases of natural gas
      activity_set_5:
        <<: *use_allocation
        names:
            - "Coal Industrial"
        clean_parameter: {"212100": 'ActivityProducedBy'} # purchases of coal
      activity_set_6: # Industrial
        <<: *fuel_MECS
        names:
            - "Coal Industrial - Manufacturing"
        allocation_flow:
            - "Coal"
      activity_set_7: # Industrial
        <<: *fuel_MECS
        names:
            - "Natural gas Industrial - Manufacturing"
        allocation_flow:
            - "Natural Gas"

  "EPA_GHGI_T_3_9": *stationary_combustion # N2O emissions from stationary combustion

## Other sources
  "EPA_GHGI_T_4_46": #CO2 for selected petrochemicals
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:  #this set is direct
          names:
            - "Acrylonitrile"
            - "Carbon Black"
            - "Ethylene"
            - "Ethylene Dichloride"
            - "Ethylene Oxide"
            - "Methanol"
          allocation_method: direct
          allocation_source: None
          allocation_from_scale: national
  "EPA_GHGI_T_3_22b": #Fossil fuel for non-energy uses
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:  #this set is direct for coal products
          names:
            - "Industry Industrial Coking Coal"
            - "Industry Industrial Other Coal"
          allocation_method: direct
          allocation_from_scale: national
        activity_set_2: # consumed petroleum products
          <<: *fuel_MECS
          names:
            - "Industry Asphalt & Road Oil"
            - "Industry Distillate Fuel Oil"
            - "Industry LPG"
            - "Industry Lubricants"
            - "Industry Miscellaneous Products"
            - "Industry Naphtha (<401 F)"
            - "Industry Other Oil (>401 F)"
            - "Industry Pentanes Plus"
            - "Industry Petroleum Coke"
            - "Industry Special Naphtha"
            - "Industry Still Gas"
            - "Industry Waxes"
          allocation_source: "EIA_MECS_Energy"
          allocation_source_class: "Other" # nonfuel consumption
          allocation_flow:
            - "Other" # consistent with original, but other flows may be better
        activity_set_3: # consumed nat gas to chemical plants
          <<: *fuel_MECS
          names:
            - "Industry Natural Gas to Chemical Plants"
          allocation_source: "EIA_MECS_Energy"
          allocation_source_class: "Other" # nonfuel consumption
          allocation_flow:
            - "Natural Gas"
        activity_set_4:
          <<: *use_allocation
          names:
            - "Transportation Lubricants"
          clean_parameter: {"324110": 'ActivityProducedBy'} # purchases of refinery

## Other Emissions
  "EPA_GHGI_T_4_50": # HFCs from HCFC-22 production
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      clean_fba_before_mapping_df_fxn: remove_HFC_kt
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
          names:
            - "HCFC-22 Production"
          allocation_method: direct
          allocation_from_scale: national
  "EPA_GHGI_T_4_94": # HFCs and other emissions from electronics manufacture
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
          names:
            - "Electronics Production"
          allocation_method: direct
          allocation_from_scale: national
  "EPA_GHGI_T_4_101": # HFCs and PFCs from ODS Substitutes
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      clean_fba_before_mapping_df_fxn: clean_HFC_fba # removes HFCs from transportation
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
          names:
            - "Refrigeration/Air Conditioning - Households"
          allocation_method: direct
          allocation_from_scale: national
        activity_set_2:
          <<: *use_allocation
          names:
            - "Refrigeration/Air Conditioning"
          clean_parameter: {"333415": 'ActivityProducedBy'} # Air conditioning equipment
        activity_set_3:
          <<: *use_allocation
          names:
            - "Foams - Polystyrene"
          clean_parameter: {"326140": 'ActivityProducedBy'} # Polystyrene foam
        activity_set_4:
          <<: *use_allocation
          names:
            - "Foams - Urethane"
          clean_parameter: {"326150": 'ActivityProducedBy'} # Urethane and other foam
  "EPA_GHGI_T_A_103": # HFCs from Transportation
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      clean_fba_before_mapping_df_fxn: split_HFCs_by_type
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
          names:
            - "Heavy-Duty Vehicles"
            - "Light-Duty Trucks"
            - "Medium- and Heavy-Duty Trucks"
            - "Passenger Cars"
            - "Rail"
            - "School and Tour Buses"
            - "Ships and Boats"
          allocation_method: direct
          allocation_from_scale: national
  "EPA_GHGI_T_4_80": # PFCs from aluminum production
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
          names:
            - "Aluminum Production"
          allocation_method: direct
          allocation_from_scale: national
  "EPA_GHGI_T_4_84": # HFCs, SF6, CO2 from magnesium production
      data_format: 'FBA'
      class: Chemicals
      geoscale_to_use: national
      year: 2016
      fedefl_mapping: 'GHGI'
      activity_sets:
        activity_set_1:
            <<: *electricity_make # Make table allocation
            names:
            - "Magnesium Production and Processing"
            clean_parameter: {"T008": 'ActivityConsumedBy'} # Gross Output
